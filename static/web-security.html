<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns#">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--
    CLEAN MARKUP = GOOD KARMA.
    Hi source code lover,
    you're a curious person and a fast learner ;)
    Let's make something beautiful together. Contribute on Github:
    https://github.com/webslides/webslides
    Thanks!
    -->
    <!-- SEO-->
    <title>安全なWebアプリケーションの作り方</title>
    <meta name="description" content="">
    <!-- URL CANONICAL-->
    <!-- <link rel="canonical" href="http://your-url.com/permalink">-->
    <!-- Google Fonts-->
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,100i,300,300i,400,400i,700,700i%7CMaitree:200,300,400,600,700&amp;subset=latin-ext" rel="stylesheet">
    <!-- CSS Base-->
    <link rel="stylesheet" type="text/css" media="all" href="./css/webslides.css">
    <link rel="stylesheet" type="text/css" media="all" href="./css/default.css">
    <!-- link(rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.1/css/bulma.min.css")-->
    <!-- Optional - CSS SVG Icons (Font Awesome)-->
    <link rel="stylesheet" type="text/css" media="all" href="./css/svg-icons.css">
    <!-- SOCIAL CARDS (ADD YOUR INFO)-->
    <!-- FACEBOOK-->
    <!-- EDIT-->
    <meta property="og:url" content="https://source.unsplash.com/R1J6Z1cnJZc/1600x800">
    <!-- EDIT-->
    <meta property="og:type" content="article">
    <meta property="og:title" content="WebSlides: Trunk Study">
    <meta property="og:description" content="created by Atsushi.">
    <!-- EDIT-->
    <meta property="og:updated_time" content="2017-04-16T16:24:56">
    <!-- EDIT-->
    <meta property="og:image:width" content="800">
    <meta property="og:image:height" content="429">
    <!-- TWITTER-->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@webslides">
    <!-- FAVICONS-->
    <link rel="shortcut icon" sizes="16x16" href="../static/images/favicons/favicon.png">
    <link rel="shortcut icon" sizes="32x32" href="../static/images/favicons/favicon-32.png">
    <link rel="apple-touch-icon icon" sizes="76x76" href="../static/images/favicons/favicon-76.png">
    <link rel="apple-touch-icon icon" sizes="120x120" href="../static/images/favicons/favicon-120.png">
    <link rel="apple-touch-icon icon" sizes="152x152" href="../static/images/favicons/favicon-152.png">
    <link rel="apple-touch-icon icon" sizes="180x180" href="../static/images/favicons/favicon-180.png">
    <link rel="apple-touch-icon icon" sizes="192x192" href="../static/images/favicons/favicon-192.png">
    <!-- Android-->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#333333">
  </head>
  <body>
    <!-- header(role='banner')-->
    <!--   nav(role='navigation')-->
    <!--     p.logo-->
    <!--       a(href='../index.html', title='WebSlides') WebSlides-->
    <!--     ul-->
    <!--       li.github-->
    <!--         a(rel='external', href='https://github.com/webslides/webslides', title='Github')-->
    <!--           svg.fa-github-->
    <!--             use(xlink:href='#fa-github')-->
    <!--           em WebSlides-->
    <!--       li.twitter-->
    <!--         a(rel='external', href='https://twitter.com/webslides', title='Twitter')-->
    <!--           svg.fa-twitter-->
    <!--             use(xlink:href='#fa-twitter')-->
    <!--           em @WebSlides-->
    <!--       // <li class="dribbble"><a rel="external" href="http://dribbble.com/webslides" title="Dribbble"><svg class="fa-dribbble"><use xlink:href="#fa-dribbble"></use></svg> <em>webslides</em></a></li>-->
    <main role="main">
      <article id="webslides">
        <!--
        Quick Guide
        - Each parent <section> in the <article id="webslides"> element is an individual slide.
        - Vertical sliding = <article id="webslides" class="vertical">
        - <div class="wrap"> = container 90% / <div class="wrap size-50"> = 45%;
        -->
        <section class="bg-red"><span class="background dark" style="background-image:url('https://source.unsplash.com/R1J6Z1cnJZc/1600x800')"></span>
          <!-- .wrap = container (width: 90%)-->
          <div class="wrap aligncenter">
            <h1><strong>安全なWebアプリケーションの作り方</strong></h1>
            <h5 class="text-symbols">***</h5>
          </div>
          <!-- .end .wrap-->
        </section>
        <section>
          <div class="wrap size-70">
            <h2><strong>Agenda</strong></h2>
            <hr>
            <ol class="text-cols">
              <li>トレーニング概要</li>
              <li>自己紹介</li>
              <li>不正利用防止対策について</li>
              <li>ステップ別セキュリティ対策</li>
            </ol>
          </div>
        </section>
        <section class="bg-green"><span class="background dark" style="background-image:url('https://images.unsplash.com/photo-1535219241072-7d3c28a49a5c')"></span>
          <!-- .wrap = container (width: 90%)-->
          <div class="wrap aligncenter fadeInUp">
            <h3><strong>トレーニング概要</strong></h3>
          </div>
          <!-- .end .wrap-->
        </section>
        <section class="slide-top">
          <h1>トレーニング概要</h1>
          <p>アプリケーションの構築ステップに分けてアプリケーションを安定稼働させるポイントを解説</p><img class="vertxcenter" src="./images/web-security/structure.svg" style="width: 1200px">
        </section>
        <section class="fullscreen"><span class="background dark" style="background-image:url('./images/cover/profile.png'); width: 60%; height: 120%; top: 50%; left: 50%; transform: translate(-50%, -50%); opacity: .4;"></span>
          <h2 style="position: relative; font-weight: bold;">WHAT I'M ABOUT</h2>
          <p style="position: relative; font-weight: bold;">
            株式会社TRUNK TL Kawasaki Atsushi<br>
            2013年じげんグループHRメディア事業のPMやバックエンドを担当。<br>
            新規事業立ち上げの経験を経てエンジニアリングユニットのマネージャーに従事。<br>
            
            2015年に株式会社カヤックへ入社。<br>
            クライアントワークや自社サービス(Lobi)のフロントエンド、バックエンドおよびインフラ設計、構築、運用を担当。<br>
          </p>
        </section>
        <section class="bg-green"><span class="background dark" style="background-image:url('https://images.unsplash.com/photo-1535219241072-7d3c28a49a5c')"></span>
          <!-- .wrap = container (width: 90%)-->
          <div class="wrap aligncenter fadeInUp">
            <h1>不正利用防止対策について</h1>
          </div>
          <!-- .end .wrap-->
        </section>
        <section class="slide-top">
          <h1>不正利用防止対策について</h1>
          <p>ここでは脆弱性の早期発見の仕組みや未然に防ぐための手法を紹介する</p>
          <ol>
            <li>脆弱性診断</li>
            <li>バグバウンティ</li>
          </ol>
        </section>
        <section class="slide-top">
          <h1>脆弱性診断</h1>
          <p>WEBアプリケーションの脆弱性診断では大きく「プラットフォーム診断」と「アプリケーション診断」がある</p>
          <ol>
            <li>プラットフォーム診断
              <p>
                サーバーやネットワークに対する脆弱性診断
                
              </p>
            </li>
            <li>アプリケーション診断
              <p>
                Webアプリケーションに対する脆弱性診断。「ブラックボックス診断」と呼ばれる診断方法では実際にWebアプリケーションを動かして診断を行う。
                一方、「ホワイトボックス診断」と呼ばれる診断方法ではソースコードを解析することにより、脆弱性を発見します。
              </p>
            </li>
          </ol>
        </section>
        <section class="slide-top">
          <h1>脆弱性診断ツールの代表例</h1>
          <h3>Nmap</h3>
          <p>ポートスキャンという機能が有名でサーバーやネットワーク機器のオープンポートを列挙する <br><a href="https://nmap.org/man/jp/">https://nmap.org/man/jp/</a></p>
          <h3>Nessus</h3>
          <p>Nessusは現在まで世界中で20,000以上の顧客と10,000,000件のダウンロードが有ったネットワーク業界で最も広く知られたネットワーク機器の 脆弱性検出とシステム機器構成評価用ソフトウェア <br><a href="https://jp.tenable.com/products/nessus/nessus-professional">https://jp.tenable.com/products/nessus/nessus-professional</a></p>
        </section>
        <section class="slide-top">
          <h1>バグバウンティ</h1>
          <p>
            バグバウンティとは「脆弱性報奨金制度」や「バグ報奨金制度」とも呼ばれ、、企業が脆弱性に報奨金をかけて一般公開し、
            一般人が発見した脆弱性を報告して報奨金を受け取る制度
          </p>
          <h2>導入例</h2>
          <h4>Google</h4>
          <p>
            Googleでは、ChromeとAndroidを分けてバグバウンティのプログラムを用意
            過去には、緊急度が高い脆弱を発見した人に対し、約330万円（30,000$）の報奨金が支払われた例もある
          </p>
          <h4>Facebook</h4>
          <p>
            Facebookとその傘下であるInstagramでバグバウンティのプログラムを用意
            2016年には、10歳の少年がInstagramの脆弱性を指摘し、約100万円（10,000$）の報奨金が支払われた
          </p>
        </section>
        <section class="bg-green"><span class="background dark" style="background-image:url('https://images.unsplash.com/photo-1535219241072-7d3c28a49a5c')"></span>
          <!-- .wrap = container (width: 90%)-->
          <div class="wrap aligncenter fadeInUp">
            <h1>ステップ別セキュリティ対策</h1>
          </div>
          <!-- .end .wrap-->
        </section>
        <section class="slide-top">
          <h1>安全なアプリケーションとは?</h1>
          <ol>
            <li>システムやネットワーク、データを安全な状態に保つ</li>
            <li>システムの安定稼働(冗長化)</li>
            <li>利用ポリシー (知的財産権/脅迫)</li>
          </ol>
        </section>
        <section class="slide-top">
          <h1>脆弱性とは?</h1>
          <p>
            脆弱性とはセキュリティバグのことを指し、悪用できるバグとも言えます。
            アプリケーションにバグはつきものですが、セキュリティーホールになりえるようなバグの例は以下になります。
          </p>
          <ol>
            <li>個人情報が閲覧できる</li>
            <li>Webサイトの内容が書き換えられる</li>
            <li>サイトを閲覧した利用者のPCを感染させる</li>
            <li>コンピューター資源を勝手に使われる (暗号通貨のマイニング)</li>
          </ol>
        </section>
        <section class="slide-top">
          <h3>アプリケーション制作ステップ</h3>
          <ol>
            <li>ドメイン取得</li>
            <li>サーバーの構築</li>
            <li>アプリケーションの作成</li>
            <li>テスト</li>
            <li>リリース</li>
          </ol><img class="vertxcenter" src="./images/web-security/structure.svg" style="width: 1200px">
        </section>
        <section class="bg-green"><span class="background dark" style="background-image:url('https://images.unsplash.com/photo-1535219241072-7d3c28a49a5c')"></span>
          <!-- .wrap = container (width: 90%)-->
          <div class="wrap aligncenter fadeInUp">
            <h3><strong>ドメイン取得</strong></h3>
          </div>
          <!-- .end .wrap-->
        </section>
        <section class="slide-top">
          <h1>ドメイン取得</h1>
          <p>
            Webドメインとは、WebサイトのURLの終わりにある.comや.jpなどのサイトが登録された場所を示す文字コードです。
            ドメインの種別は大きく分けて「gTLD」と「ccTLD」に大別できます。
            gTLDは従来、世界の誰もが登録できる「.com」「.net」「.org」と、登録にあたって一定の要件が必要とされる「.edu」「.gov」などが存在する。
            ccTLDは、各国/地域に割り当てられたTLDであり、2文字の国コードを原則として使用している。「.jp」「.au」「.us」などが例に挙げられる
            
            ※補足
            新gTLDを自分で作成しようとした場合 申請料：約1654万円、年間費用:224万円 + 様々な審査を通ればTLDが作れる
          </p>
          <h3>取得ドメインの注意点</h3>
          <p>
            vb.lyが警告なしでリビア政府によって差し押さえらた事例もあるとおりccTLDのドメインは国の情勢も考慮に入れたほうが良い。
            また、ioドメインもccTLDのドメインの一種だが、過去にioドメインの名前解決障害が起こったこともあるように実際のプロダクションで利用する場合は慎重に導入したほうがよい
          </p>
        </section>
        <section class="slide-top">
          <h1>サーバーの構築</h1>
          <ol>
            <li>ポートの開放</li>
            <li>ミドルウェアのインストール</li>
            <li>ログ管理</li>
          </ol>
        </section>
        <section class="slide-top">
          <h1>ポートの開放</h1>
          <p>
            アプリケーションを構築する上でまずはサーバーを構築することとなる
            Webサーバーの場合はポートを開放して外部からのアクセスを受け付ける必要があるが、開放するポートの設定は気をつける必要がある
          </p><img class="vertxcenter" src="./images/web-security/port.svg" style="width: 1000px">
        </section>
        <section class="slide-top">
          <h1>ポートの種類</h1>
          <h3>80/443</h3>
          <p>
            http/https通信が行われているポート
            サイト訪問者がこのポートを利用してリソースを取得するため、誰でもこのポートを利用してサーバーにアクセスすることができる
          </p>
          <h4>22</h4>
          <p>
            SSHで利用されるポート。SSHとはサーバーに接続し遠隔操作をする仕組みで主にサイト運用者がこのポートを利用する
            そのため、SSH接続が可能な接続元アドレスを指定することがよい。また、複数人でサーバーを運用する場合は権限管理の設定に気をつける
          </p>
          <h4>21</h4>
          <p>
            FTPとはFile Transfer Protocolの省略でファイルの転送に使われているプロトコル
            昔はページの更新などでこのポートが利用されていたが、現在では <strong> セキュリティ上問題 </strong> があるため現在ではほとんど使われない
            セキュリティ上の問題というのは通信データが「暗号化」されていないことにあります。つまり、接続情報が盗聴されるリクスがあります
          </p>
        </section>
        <section class="slide-top">
          <h1>ミドルウェア</h1>
          <p>
            サーバーは様々なミドルウェアを組み合わせて構築されていきます。代表例としてはApacheやNginx,Mysql,PostgreSqlがそれらにあたります。
            便利は反面、ミドルウェアの脆弱性をついたサイバー攻撃も発生します。脆弱性が見つかった場合はインストールしているミドルウェアのバージョンを確認し、
            速やかにセキュリティパッチを取り込むようにしましょう。
            セキュリティパッチ情報例
            <a href="https://www.ipa.go.jp/security/announce/about.html#section2">https://www.ipa.go.jp/security/announce/about.html#section2</a>
          </p>
        </section>
        <section class="slide-top">
          <h1>ログ管理</h1>
          <p>
            ログは情報漏えいが発生してしまったときにその被害状況や影響調査などに使用するため、ログの取得と保管が重要
            ただし、機密情報 (パスワードなど) はログに平文では書き込まないように注意
          </p>
        </section>
        <section class="bg-green"><span class="background dark" style="background-image:url('https://images.unsplash.com/photo-1535219241072-7d3c28a49a5c')"></span>
          <!-- .wrap = container (width: 90%)-->
          <div class="wrap aligncenter fadeInUp">
            <h3><strong>アプリケーションの作成</strong></h3>
          </div>
          <!-- .end .wrap-->
        </section>
        <section class="slide-top">
          <h1>ブラウザにレンダリングされるまでの流れ</h1><img class="vertxcenter" src="./images/web-security/flow.svg" style="width: 1200px">
        </section>
        <section class="slide-top">
          <h1>Request/Response</h1>
          <ol>
            <li>暗号化通信</li>
            <li>キャッシュ</li>
            <li>Cookie</li>
            <li>CORS</li>
          </ol><img class="vertxcenter" src="./images/web-security/flow-request.svg" style="width: 1200px">
        </section>
        <section class="slide-top">
          <h1>暗号化通信</h1>
          <p>
            HTTP通信でクライアントとサーバー間の通信が暗号化されておらず、盗聴される危険がある
            個人情報を扱うようなアプリケーションを作成する場合は必ずHTTPS対応が必要
            
            参考: <a href="https://letsencrypt.jp/">https://letsencrypt.jp/</a>
          </p>
          <p><img class="vertxcenter" src="./images/web-security/http.svg" style="width: 800px"></p>
          <p><img class="vertxcenter" src="./images/web-security/https.svg" style="width: 800px; margin-top: 300px;"></p>
        </section>
        <section class="slide-top">
          <h1>キャッシュ</h1>
          <p>
            キャッシュはアプリケーションのパフォーマンス向上に期待でき、多くのアプリケーションで導入されている
            ただし、セッション情報が利用されているページや個人情報が乗っているページをキャッシュすると情報漏えいの原因となるので
            キャッシュルールの設定には十分気をつける必要がある
          </p>
        </section>
        <section class="slide-top">
          <h1>Cookie</h1>
          <p>自動認証機能などを作成する場合、クッキーをアプリケーションで利用することになる</p>
          <table>
            <thead>
              <tr>
                <th>カラム名</th>
                <th>値 (例)</th>
                <th>説明</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Name</td>
                <td>_twitter</td>
                <td>クッキー名</td>
              </tr>
              <tr>
                <td>Value</td>
                <td>BAh7CSIKZmxhc2hJ...</td>
                <td>クッキー値 (暗号化したデータをセット)<br>セキュリティ上、以下のようなことを気をつける必要があります<br>・暗号化したデータをセットする<br>・パスワードなどの機密情報をクッキーにセットしない</td>
              </tr>
              <tr>
                <td>domain</td>
                <td>.twitter.com</td>
                <td>クッキーが届くドメインを指定<br>.twitter.comと指定することによりサブドメイン間との共有もできる</td>
              </tr>
              <tr>
                <td>path</td>
                <td>/</td>
                <td>クッキーを読み込めるパスを指定する<br>「/」 と指定することで全ページから読み込める</td>
              </tr>
              <tr>
                <td>Expires / Max-Age</td>
                <td>2028-09-09T01:13:08.543Z</td>
                <td>クッキーの有効期限<br> 省略するとブラウザを終了させるまでが有効期限となる</td>
              </tr>
              <tr>
                <td>HttpOnly</td>
                <td>true</td>
                <td>CookieをJavaScriptからアクセスできないように制限</td>
              </tr>
              <tr>
                <td>Secure</td>
                <td>true</td>
                <td>HTTPSで通信している場合にのみCookieを送信する</td>
              </tr>
            </tbody>
          </table>
        </section>
        <section class="slide-top">
          <h1>CORS</h1>
          <p>
            CORS (Cross-Origin Resource Sharing)とは異なるオリジン間でデータをやり取りするための取り決め
            CORSの設定はレスポンスヘッダによって行うが、同一オリジンポリシーが全く無い場合ブラウザから悪意ある攻撃者のサイトにアクセスし、
            ページのJavaScriptが実行される危険性がある
          </p>
          <table>
            <thead>
              <tr>
                <th>ヘッダ</th>
                <th>説明</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Access-Control-Allow-Origin</td>
                <td>許可するオリジン</td>
              </tr>
            </tbody>
            <tbody>
              <tr>
                <td>Access-Control-Allow-Methods</td>
                <td>許可するHTTPメソッドの種類</td>
              </tr>
            </tbody>
          </table>
        </section>
        <section class="slide-top">
          <h1>アプリケーション処理 (Backend)</h1><img class="vertxcenter" src="./images/web-security/backend.svg" style="width: 1200px">
        </section>
        <section class="slide-top">
          <h1>アプリケーション処理 (Backend)</h1>
          <ol>
            <li>入力値の検証</li>
            <li>CSRF</li>
            <li>セッション管理</li>
            <li>オープンリダイレクト</li>
            <li>メールヘッダ・インジェクション</li>
            <li>ディレクトリ・トラバーサル</li>
            <li>OSコマンドインジェクション</li>
          </ol>
        </section>
        <section class="slide-top">
          <h1>入力値の検証ステップ</h1>
          <ol>
            <li>文字エンコーディングの妥当性検証</li>
            <li>入力値の妥当性検証</li>
          </ol>
        </section>
        <section class="slide-top">
          <h1>文字エンコーディングの妥当性検証</h1>
          <p>
            Ruby1.9では不正な文字コードを受け付けない言語仕様となっているため、アプリケーションで検証を行っていないことも
            少なくないかもしれませんが、もし不正な文字コードを受け付けてしまった場合はバグの温床となる恐れがある
          </p>
        </section>
        <section class="slide-top">
          <h1>入力値の妥当性検証</h1>
          <p>
            入力値検証 (バリデーション) の主目的はセキュリティのためではないですが、セキュリティ対策に役立つ例もあります。
            ・SQLインジェクション対策が漏れていた場合でも入力値検証により実害に至らない
            などもその一つです。データの不整合を起こさないためにもバリデーションチェックはしっかり行う必要がある
          </p>
        </section>
        <section class="slide-top">
          <h1>CSRF</h1>
          <p>
            CSRF(クロスサイトリクエストフォージェリ)とはリクエスト強要とも呼ばれており、悪意のある第三者が作成したページを利用者が見た場合に
            意図しない形でショッピングカートに品物を入れてしまったり、SNSへ投稿してしまったりする攻撃の一種。
          </p>
          <pre><code>&lt;body onload=&quot;document.csrf.submit()&quot;&gt;
  &lt;form name=&quot;csrf&quot; action=&quot;http://sample.shop.com/order&quot; method=&quot;POST&quot;&gt;
    &lt;input type=&quot;hidden&quot; name=&quot;product&quot; value=&quot;bread&quot;&gt;
    &lt;input type=&quot;hidden&quot; name=&quot;amount&quot; value=&quot;1000&quot;&gt;
  &lt;/form&gt;
&lt;/body&gt;
</code></pre>
        </section>
        <section class="slide-top">
          <h2>CSRF対策</h2>
          <p>
            Webアプリケーションフレームワーク側でワンタイムトークンの発行を標準でサポートされていることが多いため、利用すると良い
            ワンタイムトークンとはページを閲覧しているユーザーごとにランダムなトークン文字列が発行され、サーバー側でトークンの検証を行うことで
            第三者からのリクエストを受けつ内容にする
          </p>
        </section>
        <section class="slide-top">
          <h1>セッション管理</h1>
          <p>
            セッションはログイン認証状態の保持する手段としてセッション管理機構が用いられています。
            主流のセッション管理機構は、クッキーなどにセッションIDを保存させ、セッションIDをキーにサーバー側で情報を記憶するという手法が取られている。
            第三者にこのセッションIDが知られると、その利用者に成りすましてアクセスされる可能性があります。第三者が悪用して成りすますことを「セッションハイジャック」
            と呼びます。
          </p>
        </section>
        <section class="slide-top">
          <h1>セッションハイジャックの対策法</h1>
          <p>
            推測可能なセッションIDを使わない
            サーバー側でセッション情報を保存する
            セッション情報を暗号化する
            セッション情報を露出させない (URLに埋め込まない)
          </p>
        </section>
        <section class="slide-top">
          <h1>その他のセキュリティ対策</h1>
          <h5 class="u-verx9-t">オープンリダイレクト</h5>
          <p>
            パラメータにより指定したURLにリダイレクトする機能をリダイレクタと呼び、任意のドメインにリダイレクトできるものをオープンリダイレクタと呼ぶ。
            利用者が信頼しているドメイン上にオープンリダイレクタ脆弱性があると、利用者は自分が信頼しているサイトを閲覧しているつもりでも知らない間に罠のサイトに誘導される可能性がある。
            対策としては「リダイレクト先のドメインをチェック」「ダイレクト先のURLを固定にする」などがある
          </p>
          <h5 class="u-verx9-t">メールヘッダ・インジェクション</h5>
          <p>
            メールヘッダーインジェクションとは、メールの件名などの入力値を改ざんすることで、Bcc:などのメールヘッダーを付加する攻撃のことをいいます。
            問い合わせフォームのようなメール送信画面にメールヘッダーインジェクションに対する脆弱性があると、迷惑メールの送信に悪用されてしまう可能性がある
            対策としてはメールのヘッダに改行が含まれていないかなどの入力値のチェックや、インジェクション対策済みのライブラリを使用するなどがある
          </p>
          <h5 class="u-verx9-t">ディレクトリ・トラバーサル</h5>
          <p>
            ディレクトリトラバーサル攻撃というのは、「../」等の親ディレクトリを示す表記をファイル名パラメータの中に混入し、サーバ内の任意のファイルを読み出そうとする攻撃である。
            外部から入力された値をもとにファイルを開こうとした場合、機密情報が流出する可能性がある。
            対策としては、入力値の検証を行ったり権限管理の設定行う必要がある
          </p><code>
            <pre># input ../../etc/passwd
dir = "/var/data1";
open(HANDLE, "<$dir/$filename");</pre></code>
          <h5 class="u-verx9-t">OSコマンドインジェクション</h5>
          <p>
            OSコマンド・インジェクションとは、不正なOSコマンドを送信することにより、攻撃対象となったPCやサーバに不正アクセスを行う攻撃の一種
            対策としては可能な限りシェル（cmd.exeなど）を起動可能な言語機能の利用を避ける、外部からの命令文をそのままコマンドラインにインジェクションさせない
          </p>
        </section>
        <section class="slide-top">
          <h1>データベース</h1><img class="vertxcenter" src="./images/web-security/database.svg" style="width: 1200px">
        </section>
        <section class="slide-top">
          <h1>データベース</h1>
          <ol>
            <li>SQLインジェクション</li>
            <li>機密情報の暗号化</li>
          </ol>
        </section>
        <section class="slide-top">
          <h1>SQLインジェクション</h1>
          <p>
            多くのWebアプリケーションがデータベースを利用していて、データの問い合わせにSQLを使用している
            SQLの呼び出しに不備がある場合、SQLインジェクションという脆弱性が生まれる
            SQLインジェクション脆弱性がある場合は以下のうようなセキュリティリスクが考えられる
          </p>
          <ol>
            <li>データベースの内部情報が外部から盗まれる</li>
            <li>データベースの内部が意図せず書き換えられる or 削除される</li>
            <li>IDとパスワードが一致せずともログインされる</li>
          </ol>
        </section>
        <section class="slide-top">
          <h1>SQLインジェクションの代表例</h1>
          <h5 class="u-verx9-t">画面サンプル</h5><img class="vertxcenter" src="./images/web-security/form.svg" style="width: 600px">
          <h5 class="u-verx9-t">テーブル情報</h5>
          <table>
            <thead>
              <tr>
                <th>id</th>
                <th>password</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>admin</td>
                <td>password</td>
              </tr>
              <tr>
                <td>hoge</td>
                <td>fuga</td>
              </tr>
            </tbody>
          </table>
          <h5 class="u-verx9-t">SQL例</h5><code>
            <pre>SELECT * FROM users WHERE id = '{$userId}' AND password = '{$passwd}';</pre></code>
        </section>
        <section class="slide-top">
          <h1>シングルクオートを使った攻撃</h1>
          <p>
            この場合ユーザーIDは「admin」でパスワードが「password」でログインできる認証機能を例に見てみる
            しかし、第三者はパスワードが知らずとも以下の入力値でログインが可能
            id: admin
            password: ' OR 'A' = 'A
          </p>
          <h5 class="u-verx9-t">手法</h5>
          <p>
            パラメータとして入力値「'」を含ませることで、パスワードに関するWHERE句の条件式を一旦終端させ、
            次にORを含ませると、「'A' = 'A'」という恒真式がORの対象になる。
            よって、WHERE句全体が常に真となり、パスワードを入力せずにユーザID「admin」としてログインすることが可能となる。
          </p>
          <h5 class="u-verx9-t">発行されたsql<code>
              <pre>SELECT * FROM users WHERE id = 'admin' AND password = '' OR 'A' = 'A';</pre></code></h5>
        </section>
        <section class="slide-top">
          <h1>セミコロンで分割</h1>
          <p>
            先ほどと同じ入力フォームがあるとして、今度は全てのユーザーを削除する構文を記述してみましょう
            id: admin
            password: '; DELETE FROM users WHERE 'A' = 'A'
            この場合、以下のSQLが発行されます。<code>
              <pre>SELECT * FROM users WHERE id = 'admin' AND password = ''; DELETE FROM users WHERE 'A' = 'A'</pre></code>
          </p>
          <p>これでテーブルの全ての情報を削除することができました</p>
        </section>
        <section class="slide-top">
          <h1>SQLインジェクション対策</h1>
          <p>ユーザーの入力値によってSQLを組み立てる場合、プレースホルダーを使用することでSQL文が変更されないようにする</p>
          <pre><code>User.where("user_id = ?", params[:user_id])</code></pre>
          <p>もし、以下のなコードの場合は全レコードを取得される危険がある</p>
          <pre><code>User.where(&quot;user_id = #{params[:user_id]}&quot;)
</code></pre>
        </section>
        <section class="slide-top">
          <h1>機密情報の暗号化</h1>
          <p>
            前章で個人情報漏えいのリスクを話しましたが、機密情報となるような「パスワード」「住所」「電話番号」などは
            データベースに保存する際は暗号化しよう
          </p><img class="vertxcenter" src="./images/web-security/table.svg" style="width: 1200px">
        </section>
        <section class="slide-top">
          <h1>アプリケーション処理 (Frontend)</h1><img class="vertxcenter" src="./images/web-security/front.svg" style="width: 1200px">
        </section>
        <section class="slide-top">
          <h1>アプリケーション処理 (Frontend)</h1>
          <ol>
            <li>クロスサイト・スクリプティング</li>
            <li>難読化</li>
          </ol>
        </section>
        <section class="slide-top">
          <h1>クロスサイト・スクリプティング</h1>
          <p>
            エンドユーザー側がWebページを制作することのできる動的サイト (ex: Twitter, Facebook) に対して、自身が制作した不正なスクリプトを
            挿入する攻撃の一種です。
          </p><img class="vertxcenter" src="./images/web-security/xss.svg" style="width: 1200px">
        </section>
        <section class="slide-top">
          <h1>事例</h1>
          <p>XSSの脆弱性を付いた攻撃はたくさんありますが、Twitterも過去にXSSの脆弱性により被害が広がりました。</p><img class="vertxcenter" src="./images/web-security/tw.jpg">
          <p>画像のようなツイートにマウスカーソルを合わせるだけで、リツイートされるというものでした</p>
        </section>
        <section class="slide-top">
          <h1>クロスサイト・スクリプティング対策</h1>
          <p>
            XSS脆弱性が発生する主要因はHTMLを生成する際の「<」や「"」に対するエスケープ漏れが原因
            したがって、エンドユーザーによって動的に生成される箇所に関してはHTML特殊文字(「<」や「"」)などをエスケープしよう
            エスケープされたタグは以下のようになります。
          </p><code>
            <pre># before
&lt;strong&gt;HTMLの特殊文字列&lt;/strong&gt;

# after
&amp;lt;strong&amp;gt;HTMLの特殊文字列&amp;lt;/strong&amp;gt;
</pre></code>
          <p>エスケープされた「&lt;」の部分は実体参照と呼ばれHTML特殊文字であっても文字列としてレンダリングされます。</p>
        </section>
        <section class="bg-green"><span class="background dark" style="background-image:url('https://images.unsplash.com/photo-1535219241072-7d3c28a49a5c')"></span>
          <!-- .wrap = container (width: 90%)-->
          <div class="wrap aligncenter fadeInUp">
            <h1>まとめ</h1>
          </div>
          <!-- .end .wrap-->
        </section>
        <section class="slide-top">
          <h1>まとめ</h1>
          <h3>サーバーの構築</h3>
          <ol>
            <li>権限管理と開放ポートは必要最低限にとどめておこう</li>
            <li>使用するミドルウェアはなるべく新しく脆弱性が発見されていないものを選ぼう</li>
            <li>ログ管理と保管はしっかりしよう。機密情報を平文で保存しないようにしよう</li>
          </ol>
          <h3 class="u-verx9-t">アプリケーションの作成</h3>
          <ol>
            <li>重要情報の通信は暗号化しよう</li>
            <li>セッションを利用している箇所のキャッシュは気をつけよう</li>
            <li>クッキーの扱いには気をつけよう</li>
          </ol>
          <h3 class="u-verx9-t">Backend</h3>
          <ol>
            <li>入力値の検証はアプリケーションの要件に合わせて行う</li>
            <li>CSRFトークンを利用する</li>
            <li>セッション管理はサーバー側でハンドリングできるようにする</li>
            <li>不正な改ざんをできないように入力チェック/エスケープを行う (メールヘッダ・インジェクション/ディレクトリ・トラバーサル/OSコマンドインジェクション)</li>
          </ol>
          <h3 class="u-verx9-t">データベース</h3>
          <ol>
            <li>SQLインジェクション対策を行う</li>
            <li>機密情報は暗号化して保存する</li>
          </ol>
          <h3 class="u-verx9-t">Frontend</h3>
          <ol>
            <li>XSS対策</li>
          </ol>
        </section>
        <section class="bg-green"><span class="background dark" style="background-image:url('./images/cover/0.jpg')"></span>
          <!-- .wrap = container (width: 90%)-->
          <div class="wrap aligncenter fadeInUp">
            <h3><strong>Thanks</strong></h3>
          </div>
        </section>
      </article>
    </main>
    <!-- main-->
    <footer>
      <div class="wrap">
        <p><span class="alignright"><a href="https://trunk.fm/" title="Trunk"><img src="./images/logos/trunk.svg" alt="Trunk"></a></span></p>
      </div>
    </footer>
    <!-- Required-->
    <script src="./js/webslides.js"></script>
    <script src="./js/highlight.pack.js"></script>
    <script>
      window.ws = new WebSlides();
      hljs.initHighlightingOnLoad();
    </script>
    <!-- Autoslide? window.ws = new WebSlides({ autoslide: 8000 });-->
    <!-- OPTIONAL - svg-icons.js (fontastic.me - Font Awesome as svg icons)-->
    <script defer="" src="../static/js/svg-icons.js"></script>
  </body>
</html>